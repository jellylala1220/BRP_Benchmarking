# 快速开始指南

这是一个5分钟快速上手指南，帮助您立即开始使用BPR基准测试框架。

## 第一步：安装依赖（1分钟）

```bash
cd bpr_benchmark
pip install -r requirements.txt
```

## 第二步：检查配置（1分钟）

打开 `configs/default.yaml`，确认以下内容：

1. **数据文件路径**是否正确：
```yaml
data:
  precleaned_file: "../Data/Precleaned_M67_Traffic_Data_September_2024.xlsx"
```

2. **路段信息**是否正确：
```yaml
roads:
  M67_115030402:
    link_id: 115030402
    length_km: 2.7138037
    capacity_vph: 6649
```

3. **要运行的模型**（可以先只运行几个快速测试）：
```yaml
models_to_run:
  - ClassicalBPR    # 最快，无需训练
  - NLS_BPR         # 快速
  - RandomForest    # 中等速度
```

## 第三步：运行基准测试（3分钟）

```bash
python run_benchmark.py
```

您将看到类似以下的输出：

```
================================================================================
BPR 基准测试框架
================================================================================
开始时间: 2024-11-11 10:30:00

步骤 1: 加载配置文件...
  ✓ 配置加载完成
  - 测试路段: ['M67_115030402']
  - 测试模型: ['ClassicalBPR', 'NLS_BPR', 'RandomForest']

步骤 2: 加载和预处理数据...
============================================================
开始数据加载和预处理
============================================================

处理路段: M67_115030402 (LinkID: 115030402)
------------------------------------------------------------
正在加载路段 115030402 的数据...
  找到 32512 条记录
  容量 C = 6649 vph, 长度 L = 2.7138037 km
  计算了小时流量率 (V = 4Q)
  计算了加权平均速度
  计算了真实行程时间 (Ground Truth)
  自由流速度 = 112.34 km/h, t_0 = 87.12 秒
  计算了 V/C 比
  计算了 HGV 份额 (p_H)
  计算了时段特征 (is_peak, is_weekday)
  清洗后剩余 31845 条记录
✓ Final Dataset 创建完成！
  形状: (31845, 14)
  时间范围: 2024-09-01 00:00:00 到 2024-09-30 23:45:00

============================================================
数据预处理完成！
============================================================

================================================================================
处理路段: M67_115030402
================================================================================

步骤 3: 分割训练/测试集...

数据分割 (分块时间分割法):
  训练集: 第 [1, 2, 3] 周, 24567 条记录
  测试集: 第 4 周, 7278 条记录

路段参数:
  - 容量: 6649 vph
  - 自由流行程时间: 87.12 秒

步骤 4: 训练和评估模型...

============================================================
运行模型: ClassicalBPR
============================================================
训练中...
模型参数: {'alpha': 0.15, 'beta': 4.0, 't_0': 87.12, 'capacity': 6649}
预测中...
评估中...

ClassicalBPR 评估结果:
--------------------------------------------------
  MAE:   15.2345 秒
  RMSE:  21.4567 秒
  MAPE:  12.34 %
  R²:    0.8765
--------------------------------------------------

分层评估（按V/C比）:
                Layer  Count  VCR_Mean      MAE     RMSE    MAPE       R2
  0.0 ≤ V/C < 0.3   2345     0.18    8.45    12.34    6.78   0.92
  0.3 ≤ V/C < 0.7   3456     0.52   12.67    18.45    9.87   0.89
  0.7 ≤ V/C < 1.0   1234     0.85   23.45    32.67   18.90   0.76
         V/C ≥ 1.0    243     1.15   45.67    58.90   35.67   0.54

✓ ClassicalBPR 完成！

[... 其他模型的输出 ...]

步骤 5: 保存结果...
保存对比表到: outputs/M67_115030402/M67_115030402_comparison.csv
保存评估报告到: outputs/M67_115030402/M67_115030402_report.txt

步骤 6: 创建可视化...
保存散点图到: outputs/M67_115030402/M67_115030402_predictions_scatter.png
保存对比柱状图到: outputs/M67_115030402/M67_115030402_comparison_bars.png
保存误差分析图到: outputs/M67_115030402/M67_115030402_error_analysis.png

步骤 7: 保存预测结果...
保存预测结果到: outputs/M67_115030402/M67_115030402_predictions.csv

================================================================================
基准测试完成！
================================================================================

M67_115030402 最佳模型:
  模型: RandomForest
  MAE: 12.3456 秒
  RMSE: 17.8901 秒
  MAPE: 10.12 %
  R²: 0.9123

完成时间: 2024-11-11 10:33:00

所有结果已保存到 outputs/ 目录
```

## 第四步：查看结果

### 1. 查看对比表

```bash
cat outputs/M67_115030402/M67_115030402_comparison.csv
```

或者用Excel打开该CSV文件。

### 2. 查看详细报告

```bash
cat outputs/M67_115030402/M67_115030402_report.txt
```

### 3. 查看可视化图表

在 `outputs/M67_115030402/` 目录下会有三张图：
- `*_predictions_scatter.png` - 预测vs真实值散点图
- `*_comparison_bars.png` - 模型对比柱状图
- `*_error_analysis.png` - 误差分析图

## 常见问题

### Q: 运行时间太长怎么办？

A: 在配置文件中减少要运行的模型数量，先只运行快速模型：
```yaml
models_to_run:
  - ClassicalBPR
  - NLS_BPR
```

### Q: 出现"找不到文件"错误？

A: 检查配置文件中的数据路径是否正确。路径是相对于 `bpr_benchmark/` 目录的。

### Q: 内存不足？

A: 如果数据量太大，可以在 `utils/data.py` 中添加数据采样：
```python
df = df.sample(frac=0.5, random_state=42)  # 只使用50%的数据
```

### Q: 想要更详细的输出？

A: 在 `run_benchmark.py` 的开头添加：
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 下一步

现在您已经成功运行了第一个基准测试！接下来可以：

1. **添加更多模型**：在配置文件中启用所有9个模型
2. **调整超参数**：在配置文件的 `model_params` 部分调整
3. **添加新路段**：在配置文件中添加其他路段的信息
4. **分析结果**：深入研究输出的CSV和图表
5. **自定义模型**：在 `models/` 目录下添加您自己的模型

## 获取帮助

如果遇到问题：
1. 查看 `README.md` 获取完整文档
2. 检查 `configs/default.yaml` 的注释
3. 查看各个模块的文档字符串

祝您使用愉快！🚀

