# BPR基准测试框架 - 项目总览

## 🎯 项目目标

构建一个完整的、模块化的BPR（Bureau of Public Roads）函数基准测试框架，用于：
1. 评估和比较9种不同的行程时间估计方法
2. 支持多路段、多模型的批量测试
3. 生成标准化的评估报告和可视化结果
4. 为交通工程研究提供可复现的基准测试平台

## 📊 实现的模型

### 组A: BPR参数估计方法（3种）
1. **ClassicalBPR** - 经典BPR（α=0.15, β=4.0）
2. **NLS_BPR** - 非线性最小二乘法
3. **LogLinearBPR** - 对数线性回归

### 组B: 机器学习方法（5种）
4. **SVR** - 支持向量回归
5. **DecisionTree** - 决策树
6. **RandomForest** - 随机森林
7. **GradientBoosting** - 梯度提升
8. **NeuralNetwork** - 神经网络

### 组C: 可靠性方法（1种）
9. **BayesianBPR** - 贝叶斯回归（带不确定性估计）

## 🏗️ 框架架构

```
┌─────────────────────────────────────────────────────────────┐
│                    run_benchmark.py                         │
│                      (总指挥)                                │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│   configs/   │    │    utils/    │    │   models/    │
│ default.yaml │    │   data.py    │    │   *.py       │
│              │    │  metrics.py  │    │              │
└──────────────┘    └──────────────┘    └──────────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              ▼
                    ┌──────────────┐
                    │   outputs/   │
                    │  结果和图表   │
                    └──────────────┘
```

## 📁 文件结构

```
bpr_benchmark/
│
├── 📋 配置层
│   └── configs/
│       └── default.yaml          # 实验配置（控制面板）
│
├── 🔧 工具层
│   └── utils/
│       ├── __init__.py
│       ├── data.py              # 数据预处理（Final Data工厂）
│       └── metrics.py           # 评估指标计算
│
├── 🤖 模型层
│   └── models/
│       ├── __init__.py
│       ├── base.py              # 模型基类和工厂
│       ├── m0_bpr.py            # BPR参数估计器
│       ├── m5_ml.py             # 机器学习模型
│       └── m6_reliability.py    # 可靠性模型
│
├── 📊 输出层
│   └── outputs/                 # 结果输出目录
│       └── .gitkeep
│
├── 🚀 主程序
│   ├── run_benchmark.py         # 主程序（启动按钮）
│   └── test_framework.py        # 框架测试脚本
│
└── 📚 文档
    ├── README.md                # 完整文档
    ├── QUICKSTART.md            # 5分钟快速开始
    ├── PROJECT_STRUCTURE.md     # 项目结构详解
    ├── OVERVIEW.md              # 本文件
    ├── requirements.txt         # 依赖包列表
    └── .gitignore              # Git忽略文件
```

## 🔄 数据流程

```
1. 原始数据 (Excel)
   └─→ utils/data.py::create_final_dataset()
        │
        ├─ 计算 V (小时流量): V = 4Q
        ├─ 计算 v (平均速度): 加权平均
        ├─ 计算 T (Ground Truth): T = 3.6L/v
        ├─ 计算 t_0 (自由流时间): 低流量中位数
        ├─ 计算 V/C 比
        ├─ 计算 HGV 份额 (p_H)
        ├─ 提取时段特征 (is_peak)
        └─ 合并天气数据 (可选)
        │
        ▼
2. Final Dataset (标准化数据)
   └─→ utils/data.py::split_data()
        │
        ├─ 训练集: 第1-3周
        └─ 测试集: 第4周
        │
        ▼
3. 模型训练和预测
   └─→ models/*.py
        │
        ├─ model.fit(df_train)
        └─ y_pred = model.predict(df_test)
        │
        ▼
4. 评估
   └─→ utils/metrics.py
        │
        ├─ calculate_all_metrics()
        ├─ calculate_stratified_metrics()
        └─ generate_evaluation_report()
        │
        ▼
5. 输出结果
   └─→ outputs/
        │
        ├─ CSV文件 (对比表、预测结果)
        ├─ TXT文件 (评估报告)
        └─ PNG图表 (可视化)
```

## 🎨 核心特性

### 1. 模块化设计
- 每个组件独立、可测试
- 易于扩展和维护
- 支持插件式添加新模型

### 2. 标准化数据流
- 统一的数据预处理流程
- 一致的Ground Truth计算
- 标准化的特征工程

### 3. 完整的评估体系
- 4种基本指标：MAE, RMSE, MAPE, R²
- 分层评估：按V/C比分组
- 时段评估：高峰vs非高峰

### 4. 丰富的输出
- 对比表（CSV）
- 详细报告（TXT）
- 可视化图表（PNG）
- 原始预测结果（CSV）

### 5. 灵活的配置
- YAML配置文件
- 支持多路段测试
- 可调整的超参数
- 可选的特征集合

## 🔬 核心公式

### BPR公式
```
T = t_0 × (1 + α × (V/C)^β)
```
- T: 行程时间（秒）
- t_0: 自由流行程时间（秒）
- V: 流量（vehicles/hour）
- C: 容量（vehicles/hour）
- α, β: 待估计参数

### Ground Truth计算
```
T = 3.6 × L / v
```
- L: 路段长度（km）
- v: 平均速度（km/h）
- T: 行程时间（秒）

### 流量转换
```
V = 4 × Q
```
- Q: 15分钟流量
- V: 小时流量率

## 📈 评估指标

### 基本指标
- **MAE** (Mean Absolute Error): 平均绝对误差
- **RMSE** (Root Mean Square Error): 均方根误差
- **MAPE** (Mean Absolute Percentage Error): 平均绝对百分比误差
- **R²** (R-squared): 决定系数

### 分层指标
按V/C比分组：
- [0.0, 0.3): 自由流
- [0.3, 0.7): 中等拥堵
- [0.7, 1.0): 高拥堵
- [1.0, ∞): 超容量

### 时段指标
- 高峰时段 (07:00-09:00, 15:00-18:00)
- 非高峰时段

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 测试框架
```bash
python test_framework.py
```

### 3. 运行基准测试
```bash
python run_benchmark.py
```

### 4. 查看结果
```bash
ls outputs/M67_115030402/
```

## 📖 文档导航

- **新手入门**: 阅读 `QUICKSTART.md`（5分钟上手）
- **完整文档**: 阅读 `README.md`（详细说明）
- **架构理解**: 阅读 `PROJECT_STRUCTURE.md`（深入理解）
- **本文件**: `OVERVIEW.md`（总览）

## 🔧 技术栈

### 核心依赖
- **Python 3.8+**: 编程语言
- **pandas**: 数据处理
- **numpy**: 数值计算
- **scipy**: 科学计算和优化
- **scikit-learn**: 机器学习
- **pyyaml**: 配置文件解析

### 可选依赖
- **matplotlib**: 可视化
- **seaborn**: 高级可视化
- **tqdm**: 进度条

## 🎯 使用场景

### 场景1: 基准测试
比较不同方法在同一数据集上的性能

### 场景2: 参数优化
为特定路段找到最佳的BPR参数

### 场景3: 特征分析
研究不同特征（HGV、时段、天气）的影响

### 场景4: 模型开发
开发和测试新的行程时间估计方法

### 场景5: 论文研究
为学术研究提供可复现的实验平台

## 🔄 扩展指南

### 添加新模型
1. 在 `models/` 创建新文件
2. 继承 `BaseModel` 类
3. 实现 `fit()` 和 `predict()` 方法
4. 在 `base.py` 中注册

### 添加新特征
1. 在 `utils/data.py` 的 `create_final_dataset()` 中计算
2. 在配置文件中定义
3. 在模型中使用

### 添加新指标
1. 在 `utils/metrics.py` 中实现计算函数
2. 在 `calculate_all_metrics()` 中调用
3. 在报告生成中展示

### 添加新路段
1. 在配置文件的 `roads` 部分添加信息
2. 在 `roads_to_test` 中添加名称

## 📊 预期输出

### 对比表示例
| Model | MAE | RMSE | MAPE | R² |
|-------|-----|------|------|----|
| GradientBoosting | 12.34 | 18.56 | 8.45 | 0.92 |
| RandomForest | 13.21 | 19.34 | 9.12 | 0.91 |
| NeuralNetwork | 14.56 | 20.78 | 10.23 | 0.89 |
| BayesianBPR | 15.23 | 21.45 | 11.34 | 0.88 |
| NLS_BPR | 16.78 | 23.45 | 12.67 | 0.85 |
| LogLinearBPR | 17.89 | 24.56 | 13.45 | 0.84 |
| SVR | 18.23 | 25.34 | 14.12 | 0.82 |
| DecisionTree | 19.45 | 26.78 | 15.23 | 0.80 |
| ClassicalBPR | 20.67 | 28.90 | 16.45 | 0.78 |

### 可视化图表
1. **预测vs真实值散点图**: 9个子图，每个模型一个
2. **模型对比柱状图**: 4个子图（MAE, RMSE, MAPE, R²）
3. **误差分析图**: V/C比 vs 预测误差

## ⚠️ 注意事项

1. **数据质量**: 确保输入数据的质量和完整性
2. **参数边界**: BPR参数应在合理范围内（α: 0.01-1.0, β: 1.0-10.0）
3. **计算资源**: 某些模型（如神经网络）可能需要较长训练时间
4. **内存使用**: 大数据集可能需要大量内存
5. **结果解释**: 不同指标可能给出不同的"最佳模型"

## 🤝 贡献指南

欢迎贡献！您可以：
1. 报告bug
2. 提出新功能建议
3. 提交代码改进
4. 改进文档
5. 分享使用经验

## 📝 引用

如果您在研究中使用本框架，请引用相关论文。

## 📧 联系方式

如有问题或建议，请联系项目维护者。

## 📜 许可证

本项目仅供学术研究使用。

---

**版本**: 1.0.0  
**最后更新**: 2024-11-11  
**状态**: ✅ 已完成，可用于生产

---

## 🎉 总结

这是一个**完整的、生产就绪的**BPR基准测试框架，具有：

✅ **9种模型实现**  
✅ **完整的数据处理流程**  
✅ **标准化的评估体系**  
✅ **丰富的可视化输出**  
✅ **模块化的架构设计**  
✅ **详细的文档**  
✅ **测试脚本**  

**立即开始使用吧！** 🚀

