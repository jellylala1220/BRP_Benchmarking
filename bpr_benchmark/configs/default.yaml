# BPR 基准测试配置文件
# 这是实验的"控制面板"

# 数据源配置
data:
  precleaned_file: "../Data/Precleaned_M67_Traffic_Data_September_2024.xlsx"
  weather_file: null  # 未来添加天气数据
  
# 路段配置
roads:
  M67_115030402:
    link_id: 115030402
    link_name: "M67 westbound between J4 and J3"
    link_length_m: 2713.8037  # 路段长度（米）
    length_km: 2.7138037  # 2713.8037m（保留兼容）
    capacity_vph: 6649  # vehicles per hour
    snapshot_csv: "../Data/M67 westbound between J4 and J3 mainCarriageway 115030402.csv"
    description: "主要测试路段"

# 要测试的路段列表
roads_to_test:
  - M67_115030402

# 模型配置（使用新架构的模型名称）
models_to_run:
  # M0: 基准BPR模型
  - M0  # 支持方法: classical, loglinear, nls
  
  # M1: 动态参数BPR
  - M1  # 支持方法: classical, loglinear, nls
  
  # M2: 基本图VDF
  - M2  # 支持方法: tree, rf, gbdt
  
  # M3: 多类别BPR
  - M3  # 支持方法: classical, loglinear, nls
  
  # M4: 外部因素BPR
  - M4  # 支持方法: tree, rf, gbdt
  
  # M5: ML混合BPR
  - M5  # 支持方法: svr, tree, rf, gbdt, nn
  
  # M6: 可靠性BPR
  - M6  # 支持方法: bayes

# 估计方法配置（留空表示使用每个模型兼容的所有方法）
methods_to_run: []  # 空列表 = 自动使用所有兼容方法

# 特征配置 (对应M1-M6的概念)
features:
  base:
    - V_C_Ratio      # 流量容量比 (所有模型都用)
    - t_0            # 自由流行程时间
  
  m1_dynamic:        # M1: 动态参数
    - is_peak        # 是否高峰时段
    - hour           # 小时
    - is_weekday     # 是否工作日
  
  m3_multiclass:     # M3: 多类别 (HGV)
    - p_H            # HGV份额
  
  m4_external:       # M4: 外部因素
    - is_raining     # 是否下雨 (未来)
    - temperature    # 温度 (未来)

# 时段定义 (M1: 动态参数)
time_periods:
  morning_peak:
    start: "07:00"
    end: "09:00"
  evening_peak:
    start: "15:00"
    end: "18:00"

# 数据分割配置 (分块时间分割法)
data_split:
  method: "temporal_block"  # 时间分块
  train_weeks: [1, 2, 3]    # 第1-3周训练
  test_week: 4              # 第4周测试

# 自由流速度估计配置
free_flow:
  method: "low_volume_median"  # 使用低流量时的中位数速度
  volume_threshold: 500        # V < 500 vph 被认为是自由流

# HGV 定义 (M3: 多类别)
vehicle_categories:
  light:
    - Category1  # 汽车
    - Category2  # 轻型货车
  heavy:
    - Category3  # 刚性HGV
    - Category4  # 铰接式HGV

# 模型超参数
model_params:
  RandomForest:
    n_estimators: 100
    max_depth: 10
    random_state: 42
  
  GradientBoosting:
    n_estimators: 100
    learning_rate: 0.1
    max_depth: 5
    random_state: 42
  
  NeuralNetwork:
    hidden_layer_sizes: [64, 32, 16]
    max_iter: 1000
    random_state: 42
  
  SVR:
    kernel: 'rbf'
    C: 1.0
    epsilon: 0.1

# 评估指标配置
metrics:
  primary:
    - MAE    # 平均绝对误差
    - RMSE   # 均方根误差
    - MAPE   # 平均绝对百分比误差
    - R2     # R平方
  
  stratified:  # 分层评估
    by_vcr:    # 按V/C比分组
      - [0.0, 0.3]    # 自由流
      - [0.3, 0.7]    # 中等拥堵
      - [0.7, 1.0]    # 高拥堵
      - [1.0, 999]    # 超容量

# 输出配置
output:
  dir: "../outputs"
  save_predictions: true
  save_plots: true
  save_summary: true

